<app-status-bar />

<section>
  <div class="back">
    <button type="button" class="small" shButton routerLink="/" i18n>
      <sh-icon>arrow-left</sh-icon>
      Back
    </button>
  </div>

  <article>
    <h1 i18n>Local database for {{ activeBackup()?.Backup?.Name }}</h1>
    <p i18n>
      Each backup has a local database associated with it, which stores information about the remote backup on the local
      machine. This makes it faster to perform many operations, and reduces the amount of data that needs to be
      downloaded for each operation.
    </p>
  </article>

  <article>
    <h2 i18n>Maintenance</h2>
    <p i18n>
      If the backup and the remote storage is out of sync, Duplicati will require that you perform a repair operation to
      synchronize the database. If the repair is unsuccessful, you can delete the local database and re-generate. The
      bug report button can be used to create a copy of the database with path information removed. This should only be
      used if a developer requests to investigate an issue with your database.
    </p>

    <div class="actions maintenance">
      <button
        shButton
        i18n
        [class.loader]="isRepairing()"
        [disabled]="!isValidatedPath() || pathHasChanged()"
        (click)="repairDatabase()">
        <sh-icon>wrench</sh-icon>
        Repair
      </button>

      <button
        shButton
        i18n
        [class.loader]="isDeleting()"
        [disabled]="!isValidatedPath() || pathHasChanged()"
        (click)="deleteDatabase()">
        <sh-icon>trash</sh-icon>
        Delete
      </button>

      <button shButton i18n [class.loader]="isRestoring()" [disabled]="pathHasChanged()" (click)="restoreDatabase()">
        <sh-icon>clock-counter-clockwise</sh-icon>
        Recreate (delete and repair)
      </button>

      <button
        shButton
        i18n
        [class.loader]="isCreatingBugReport()"
        [disabled]="isCreatingBugReport() || !isValidatedPath() || pathHasChanged()"
        (click)="createErrorReport()">
        <sh-icon>file-plus</sh-icon>
        Create bug report database
      </button>
    </div>
  </article>

  <article>
    <h2 i18n>Placement</h2>

    <sh-form-field [class]="isValidatedPath() ? 'success' : 'error'">
      <input type="text" [(ngModel)]="backupFilePath" />
      @if (isWaitingForValidation()) {
        <sh-icon class="primary" prefix>spinner</sh-icon>
      } @else if (isValidatedPath()) {
        <sh-icon prefix>check</sh-icon>
      } @else {
        <sh-icon prefix [shTooltip]="'File not found'">warning</sh-icon>
      }
    </sh-form-field>

    <div class="actions placement">
      <button shButton i18n [disabled]="!pathHasChanged()" (click)="resetDatabasePath()">
        <sh-icon>backspace</sh-icon>
        Reset
      </button>
      <button shButton i18n [disabled]="!pathHasChanged() || isWaitingForValidation()" (click)="saveDatabasePath()">
        <sh-icon>floppy-disk</sh-icon>
        Save
      </button>
      <button
        shButton
        i18n
        [disabled]="!pathHasChanged() || isWaitingForValidation()"
        (click)="saveAndRepairDatabasePath()">
        <sh-icon>wrench</sh-icon>
        Save & Repair
      </button>
      <button
        shButton
        i18n
        [disabled]="!pathHasChanged() || isValidatedPath() || isWaitingForValidation()"
        (click)="moveDatabasePath()">
        <sh-icon>flow-arrow</sh-icon>
        Move existing database
      </button>
    </div>
  </article>
</section>
