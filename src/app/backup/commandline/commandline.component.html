<app-status-bar />

<section>
  <div class="back">
    <button type="button" class="small" shButton routerLink="/" i18n>
      <sh-icon>arrow-left</sh-icon>
      Back
    </button>
  </div>

  @if (!finishedLoading()) {
    <sh-progress-bar class="indeterminate primary"></sh-progress-bar>
  } @else {
    <form [formGroup]="baseCmdForm">
      <sh-select [options]="commandOptions() ?? ['backup']" [inlineSearch]="true" placeholder="Select a command...">
        <label for="command" i18n>Command</label>
        <input type="text" id="command" formControlName="command" />
      </sh-select>

      <sh-form-field>
        <label for="targetUrl" i18n>TargetUrl</label>
        <textarea id="targetUrl" autocomplete="off" formControlName="targetUrl"></textarea>
      </sh-form-field>

      <sh-form-field>
        <label for="arguments" i18n>Commandline Arguments</label>
        <textarea id="arguments" autocomplete="off" formControlName="arguments"></textarea>
      </sh-form-field>
    </form>

    <sh-divider i18n>Advanced options</sh-divider>

    <form [formGroup]="standardFields">
      <sh-form-field>
        <label for="backup-id" i18n>Backup ID</label>
        <input id="backup-id" formControlName="backup-id" />
      </sh-form-field>

      <sh-form-field>
        <label for="backup-name" i18n>Backup Name</label>
        <input id="backup-name" formControlName="backup-name" />
      </sh-form-field>

      <app-toggle-card [disallowToggle]="true">
        <ng-container title i18n>Filters</ng-container>
        <ng-container content formGroupName="filters">
          @for (filterCtrl of standardFields.controls.filters.controls; track $index) {
            <sh-form-field>
              <input id="filter-{{ $index }}" [formControl]="filterCtrl" />
            </sh-form-field>
          }
        </ng-container>
      </app-toggle-card>
    </form>

    <p i18n>
      The backups will be split up into multiple files called volumes. Here you can set the maximum size of the
      individual volume files.
      <a href="#" class="sh-primary">Read more</a>
    </p>

    <app-options-list [(options)]="settings" [hasFreeTextSettings]="true" />

    <div class="form-actions">
      <button shButton class="raised primary" [class.loader]="isSubmitting()" (click)="submit()" i18n>
        <sh-icon>arrow-right</sh-icon>
        Run "{{ baseCmdForm.value.command }}" command now
      </button>
    </div>
  }
</section>
