<spk-toggle-card [disallowToggle]="true">
  <ng-container title i18n>
    Advanced options

    <spk-menu [searchable]="true">
      <button spk-button type="button" class="outlined small">
        Add advanced option
        <spk-icon>plus</spk-icon>
      </button>

      <ng-container menu>
        @for (group of nonSelectedOptionsGrouped(); track $index) {
          <h3 title>{{ group.displayName }}</h3>

          @for (option of group.options; track $index) {
            <button #option type="button" (click)="addSetting(option)">{{ option.name }}</button>
          }
        }
      </ng-container>
    </spk-menu>
  </ng-container>

  @for (item of selectedSettings(); track $index) {
    <div class="field-row">
      @if (item.FormView.type === 'FileTree') {
        <app-file-tree
          [startingPath]="item.Value()"
          [accepts]="item.FormView.accepts"
          [showFiles]="true"
          [showHiddenNodes]="true"
          [selectFiles]="true">
          <label for="destination-{{ item.Name }}-{{ $index }}">
            {{ item.FormView.shortDescription }}
            @if (item.FormView.longDescription) {
              <spk-tooltip class="primary" [message]="item.FormView.longDescription">
                <spk-icon>question</spk-icon>
              </spk-tooltip>
            }
          </label>
          <input
            type="text"
            id="destination-{{ item.Name }}-{{ $index }}"
            [ngModel]="item.Value()"
            (ngModelChange)="updateSettingValue(item, $event)" />
        </app-file-tree>
      } @else if (item.FormView.type === 'FolderTree') {
        <app-file-tree [startingPath]="item.Value()">
          <label for="destination-{{ item.Name }}-{{ $index }}">
            {{ item.FormView.shortDescription }}
            @if (item.FormView.longDescription) {
              <spk-tooltip class="primary" [message]="item.FormView.longDescription">
                <spk-icon>question</spk-icon>
              </spk-tooltip>
            }
          </label>
          <input
            type="text"
            id="destination-{{ item.Name }}-{{ $index }}"
            [ngModel]="item.Value()"
            (ngModelChange)="updateSettingValue(item, $event)" />
        </app-file-tree>
      } @else if (
        item.FormView.type === 'String' || item.FormView.type === 'Path' || item.FormView.type === 'Decimal'
      ) {
        <spk-form-field>
          <label for="destination-{{ item.Name }}-{{ $index }}">
            {{ item.FormView.shortDescription }}
            @if (item.FormView.longDescription) {
              <spk-tooltip class="primary" [message]="item.FormView.longDescription">
                <spk-icon>question</spk-icon>
              </spk-tooltip>
            }
          </label>

          <input
            type="text"
            id="destination-{{ item.Name }}-{{ $index }}"
            [ngModel]="item.Value()"
            (ngModelChange)="updateSettingValue(item, $event)" />

          @if (item.FormView.type === 'Path') {
            <spk-icon prefix>link</spk-icon>
          } @else {
            <spk-icon prefix>textbox</spk-icon>
          }
        </spk-form-field>
      } @else if (item.FormView.type === 'Password') {
        <spk-form-field>
          <label for="destination-{{ item.Name }}-{{ $index }}">
            {{ item.FormView.shortDescription }}
          </label>
          <input
            [type]="$any(item).showPassword ? 'text' : 'password'"
            autocomplete="off"
            id="destination-{{ item.Name }}-{{ $index }}"
            [ngModel]="item.Value()"
            (ngModelChange)="updateSettingValue(item, $event)" />

          <spk-icon prefix>password</spk-icon>
          @if ($any(item).showPassword) {
            <spk-icon class="clickable" suffix (click)="$any(item).showPassword = !$any(item).showPassword">
              eye
            </spk-icon>
          } @else {
            <spk-icon class="clickable" suffix (click)="$any(item).showPassword = !$any(item).showPassword">
              eye-slash
            </spk-icon>
          }
        </spk-form-field>
      } @else if (item.FormView.type === 'Enumeration') {
        <spk-select [options]="item.FormView.options!" [isClearable]="false" [optionTemplate]="enumOptionTemplate">
          <label for="destination-{{ item.Name }}-{{ $index }}">
            {{ item.FormView.shortDescription }}

            @if (item.FormView.longDescription) {
              <spk-tooltip class="primary" [message]="item.FormView.longDescription">
                <spk-icon>question</spk-icon>
              </spk-tooltip>
            }
          </label>
          <input
            type="text"
            id="destination-{{ item.Name }}-{{ $index }}"
            [ngModel]="item.Value()"
            (ngModelChange)="updateSettingValue(item, $event)" />
        </spk-select>

        <ng-template let-item #enumOptionTemplate>
          {{ item }}
        </ng-template>
      } @else if (item.FormView.type === 'Size') {
        <div class="form-column">
          <label for="destination-{{ item.Name }}-{{ $index }}">
            {{ item.FormView.shortDescription }}

            @if (item.FormView.longDescription) {
              <spk-tooltip class="primary" [message]="item.FormView.longDescription">
                <spk-icon>question</spk-icon>
              </spk-tooltip>
            }
          </label>

          <div class="form-row">
            <spk-form-field>
              <input
                type="number"
                id="destination-{{ item.Name }}-{{ $index }}"
                [ngModel]="$any(item).size()"
                (ngModelChange)="updateSizeSetting(item, $event, 'size')" />

              <spk-icon prefix>resize</spk-icon>
            </spk-form-field>

            <spk-select
              i18n-placeholder
              placeholder="Select an item..."
              [options]="sizeOptions()"
              [isClearable]="false">
              <input
                type="text"
                [ngModel]="$any(item).unit()"
                (ngModelChange)="updateSizeSetting(item, $event, 'unit')" />
            </spk-select>
          </div>
        </div>
      } @else if (item.FormView.type === 'Integer') {
        <spk-form-field>
          <label for="destination-{{ item.Name }}-{{ $index }}">
            {{ item.FormView.shortDescription }}
            @if (item.FormView.longDescription) {
              <spk-tooltip class="primary" [message]="item.FormView.longDescription">
                <spk-icon>question</spk-icon>
              </spk-tooltip>
            }
          </label>
          <input
            type="number"
            id="destination-{{ item.Name }}-{{ $index }}"
            [ngModel]="item.Value()"
            (ngModelChange)="updateSettingValue(item, $event)" />
          <spk-icon prefix>numpad</spk-icon>
        </spk-form-field>
      } @else if (item.FormView.type === 'Boolean') {
        <spk-toggle class="primary raised">
          <label for="destination-{{ item.Name }}-{{ $index }}">
            {{ item.FormView.shortDescription }}
            @if (item.FormView.longDescription) {
              <spk-tooltip class="primary" [message]="item.FormView.longDescription">
                <spk-icon>question</spk-icon>
              </spk-tooltip>
            }
          </label>
          <input
            type="checkbox"
            id="destination-{{ item.Name }}-{{ $index }}"
            [ngModel]="item.Value()"
            (ngModelChange)="updateSettingValue(item, $event)" />
        </spk-toggle>
      } @else if (item.FormView.type === 'Flags') {
        <spk-select
          [options]="item.FormView.options!"
          [selectMultiple]="true"
          class="primary raised"
          [optionTemplate]="optionTemplate">
          <label for="destination-{{ item.Name }}-{{ $index }}">
            {{ item.FormView.shortDescription }}
            @if (item.FormView.longDescription) {
              <spk-tooltip class="primary" [message]="item.FormView.longDescription">
                <spk-icon>question</spk-icon>
              </spk-tooltip>
            }
          </label>
          <input type="text" id="text" [ngModel]="item.Value()" (ngModelChange)="updateSettingValue(item, $event)" />
        </spk-select>

        <ng-template let-item #optionTemplate>
          {{ item }}
        </ng-template>
      } @else if (item.FormView.type === 'Timespan') {
        <spk-form-field>
          <label for="destination-{{ item.Name }}-{{ $index }}">
            {{ item.FormView.shortDescription }}
            @if (item.FormView.longDescription) {
              <spk-tooltip class="primary" [message]="item.FormView.longDescription">
                <spk-icon>question</spk-icon>
              </spk-tooltip>
            }
          </label>
          <input
            type="text"
            id="destination-{{ item.Name }}-{{ $index }}"
            [ngModel]="item.Value()"
            (ngModelChange)="updateSettingValue(item, $event)" />
        </spk-form-field>
      }

      <button spk-button class="outlined remove-btn" type="button" (click)="removeSetting(item)">
        <spk-icon>x-bold</spk-icon>
      </button>
    </div>
  }
</spk-toggle-card>
