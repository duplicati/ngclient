<form [formGroup]="optionsForm" #formRef (submit)="submit()">
  <h3 class="title-30" i18n>Options</h3>

  <div class="remote-volume-wrap">
    <div class="row-inputs" formGroupName="remoteVolumeSize">
      <spk-form-field>
        <label for="size" i18n>
          Remote volume size
          @if (exceededVolumeSize()) {
            <spk-icon class="warning">warning</spk-icon>
          }
        </label>
        <input type="number" id="size" formControlName="size" />
      </spk-form-field>

      <spk-select
        i18n-placeholder
        placeholder="Select an option..."
        [isClearable]="false"
        [options]="sizeOptions()"
        [inlineSearch]="true">
        <input type="text" formControlName="unit" />
      </spk-select>
    </div>

    @if (exceededVolumeSize()) {
      <p class="warning" i18n>
        The chosen size is outside the recommended range. This may cause performance issues, excessively large temporary
        files or other problems.
      </p>
    }
    <p i18n>
      The backups will be split up into multiple files called volumes. Here you can set the maximum size of the
      individual volume files.
      <a href="https://forum.duplicati.com/t/choosing-sizes-in-duplicati/17683" target="_blank" class="spk-primary">
        Read more
        <spk-icon suffix>arrow-square-out</spk-icon>
      </a>
    </p>
  </div>

  <spk-select [options]="retentionOptions()" [inlineSearch]="false" [isClearable]="false" value="value" label="name">
    <label for="size" i18n>Backup retention</label>
    <input type="text" formControlName="backupRetention" />
  </spk-select>

  @if (optionsForm.get('backupRetention')?.value === 'all') {
    <p i18n>Nothing will be deleted. The backup size will grow with each change.</p>
  } @else if (optionsForm.get('backupRetention')?.value === 'time') {
    <p i18n>If at least one newer backup is found, all backups older than this date are deleted.</p>
    <spk-form-field>
      <label for="backupRetentionTime" i18n>Time to keep versions</label>
      <input type="text" id="backupRetentionTime" formControlName="backupRetentionTime" />
    </spk-form-field>
  } @else if (optionsForm.get('backupRetention')?.value === 'versions') {
    <p i18n>Once there are more backups than the specified number, the oldest backups are deleted.</p>
    <spk-form-field>
      <label for="backupRetentionVersions" i18n>Number of versions</label>
      <input type="number" id="backupRetentionVersions" formControlName="backupRetentionVersions" />
    </spk-form-field>
  } @else if (optionsForm.get('backupRetention')?.value === 'smart') {
    <p i18n>
      Over time backups will be deleted automatically. There will remain one backup for each of the last 7 days, each of
      the last 4 weeks, each of the last 12 months. There will always be at least one remaining backup.
    </p>
  } @else if (optionsForm.get('backupRetention')?.value === 'custom') {
    <p i18n>
      Enter a retention strategy manually. Placeholders are D/W/Y for days/weeks/years and U for unlimited. The syntax
      is: 7D:1D,4W:1W,36M:1M. This example keeps one backup for each of the next 7 days, one for each of the next 4
      weeks, and one for each of the next 36 months. This can also be written as 1W:1D,1M:1W,3Y:1M.
    </p>
    <spk-form-field>
      <p i18n>Once there are more backups than the specified number, the oldest backups are deleted.</p>
      <label for="backupRetentionCustom" i18n>Retention expression</label>
      <input type="number" id="backupRetentionCustom" formControlName="backupRetentionCustom" />
    </spk-form-field>
  }

  <app-options-list
    [(options)]="settings"
    [hiddenOptions]="[
      'encryption-module',
      '--no-encryption',
      '--exclude-files-attributes',
      '--skip-files-larger-than',
      'dblock-size',
      'no-encryption',
      'keep-time',
      'keep-versions',
      'retention-policy',
    ]" />

  <div class="form-actions">
    <button spk-button type="button" (click)="goBack()" i18n>
      <spk-icon>arrow-left</spk-icon>
      Go back
    </button>

    <button spk-button class="raised primary" [class.loader]="isSubmitting()" type="submit" i18n>
      <spk-icon>arrow-right</spk-icon>
      Submit
    </button>
  </div>
</form>
